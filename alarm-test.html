<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>알람 기능 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.2);
        }
        .success { background: rgba(46, 204, 113, 0.3); }
        .error { background: rgba(231, 76, 60, 0.3); }
        .warning { background: rgba(241, 196, 15, 0.3); }
        .info { background: rgba(52, 152, 219, 0.3); }
    </style>
</head>
<body>
    <h1>🔔 알람 기능 진단 도구</h1>
    
    <div class="test-section">
        <h2>1. 브라우저 지원 확인</h2>
        <div id="browserSupport"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 알림 권한 상태</h2>
        <div id="permissionStatus"></div>
        <button onclick="requestPermission()">알림 권한 요청</button>
    </div>
    
    <div class="test-section">
        <h2>3. 즉시 알림 테스트</h2>
        <button onclick="testImmediateNotification()">즉시 알림 테스트</button>
        <div id="immediateTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. 지연 알림 테스트</h2>
        <button onclick="testDelayedNotification()">5초 후 알림 테스트</button>
        <div id="delayedTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>5. 할일 알람 시뮬레이션</h2>
        <button onclick="testTodoAlarm()">할일 알람 시뮬레이션</button>
        <div id="todoTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>6. 콘솔 로그</h2>
        <div id="consoleLog"></div>
        <button onclick="clearLog()">로그 지우기</button>
    </div>

    <script>
        // 콘솔 로그 캡처
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('consoleLog');
        
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        function clearLog() {
            logContainer.innerHTML = '';
        }
        
        // 브라우저 지원 확인
        function checkBrowserSupport() {
            const support = document.getElementById('browserSupport');
            let html = '';
            
            // Notification API 지원
            const notificationSupported = 'Notification' in window;
            html += `<div class="status ${notificationSupported ? 'success' : 'error'}">
                Notification API: ${notificationSupported ? '지원됨' : '지원 안됨'}
            </div>`;
            
            // Service Worker 지원
            const swSupported = 'serviceWorker' in navigator;
            html += `<div class="status ${swSupported ? 'success' : 'error'}">
                Service Worker: ${swSupported ? '지원됨' : '지원 안됨'}
            </div>`;
            
            // 브라우저 정보
            html += `<div class="status info">
                User Agent: ${navigator.userAgent}
            </div>`;
            
            support.innerHTML = html;
        }
        
        // 권한 상태 확인
        function checkPermissionStatus() {
            const status = document.getElementById('permissionStatus');
            const permission = Notification.permission;
            
            let statusClass = 'warning';
            let statusText = '알 수 없음';
            
            switch(permission) {
                case 'granted':
                    statusClass = 'success';
                    statusText = '허용됨';
                    break;
                case 'denied':
                    statusClass = 'error';
                    statusText = '거부됨';
                    break;
                case 'default':
                    statusClass = 'warning';
                    statusText = '요청 필요';
                    break;
            }
            
            status.innerHTML = `<div class="status ${statusClass}">
                알림 권한: ${statusText}
            </div>`;
        }
        
        // 권한 요청
        async function requestPermission() {
            try {
                const permission = await Notification.requestPermission();
                console.log('권한 요청 결과:', permission);
                checkPermissionStatus();
                
                if (permission === 'granted') {
                    addLog('알림 권한이 허용되었습니다!', 'success');
                } else {
                    addLog('알림 권한이 거부되었습니다.', 'error');
                }
            } catch (error) {
                console.error('권한 요청 실패:', error);
                addLog('권한 요청 실패: ' + error.message, 'error');
            }
        }
        
        // 즉시 알림 테스트
        function testImmediateNotification() {
            const result = document.getElementById('immediateTestResult');
            
            if (Notification.permission !== 'granted') {
                result.innerHTML = '<div class="status error">알림 권한이 허용되지 않았습니다.</div>';
                return;
            }
            
            try {
                const notification = new Notification('🔔 즉시 알림 테스트', {
                    body: '이 알림이 보이면 알림 기능이 정상 작동합니다!',
                    tag: 'immediate-test'
                });
                
                notification.onclick = function() {
                    console.log('즉시 알림 클릭됨');
                    notification.close();
                };
                
                setTimeout(() => {
                    notification.close();
                }, 5000);
                
                result.innerHTML = '<div class="status success">즉시 알림이 표시되었습니다!</div>';
                console.log('즉시 알림 테스트 성공');
                
            } catch (error) {
                result.innerHTML = '<div class="status error">즉시 알림 생성 실패: ' + error.message + '</div>';
                console.error('즉시 알림 테스트 실패:', error);
            }
        }
        
        // 지연 알림 테스트
        function testDelayedNotification() {
            const result = document.getElementById('delayedTestResult');
            
            if (Notification.permission !== 'granted') {
                result.innerHTML = '<div class="status error">알림 권한이 허용되지 않았습니다.</div>';
                return;
            }
            
            result.innerHTML = '<div class="status info">5초 후에 알림이 표시됩니다...</div>';
            console.log('지연 알림 테스트 시작 - 5초 후 알림 예정');
            
            setTimeout(() => {
                try {
                    const notification = new Notification('⏰ 지연 알림 테스트', {
                        body: '5초 후에 알림이 표시되었습니다!',
                        tag: 'delayed-test'
                    });
                    
                    notification.onclick = function() {
                        console.log('지연 알림 클릭됨');
                        notification.close();
                    };
                    
                    setTimeout(() => {
                        notification.close();
                    }, 5000);
                    
                    result.innerHTML = '<div class="status success">지연 알림이 성공적으로 표시되었습니다!</div>';
                    console.log('지연 알림 테스트 성공');
                    
                } catch (error) {
                    result.innerHTML = '<div class="status error">지연 알림 생성 실패: ' + error.message + '</div>';
                    console.error('지연 알림 테스트 실패:', error);
                }
            }, 5000);
        }
        
        // 할일 알람 시뮬레이션
        function testTodoAlarm() {
            const result = document.getElementById('todoTestResult');
            
            if (Notification.permission !== 'granted') {
                result.innerHTML = '<div class="status error">알림 권한이 허용되지 않았습니다.</div>';
                return;
            }
            
            // 현재 시간에서 1분 후로 설정
            const now = new Date();
            const alarmTime = new Date(now.getTime() + 60000); // 1분 후
            
            const testTodo = {
                id: 'test-todo-' + Date.now(),
                text: '테스트 할일',
                time: alarmTime.toTimeString().slice(0, 5),
                priority: 'high',
                completed: false,
                date: alarmTime.toISOString().slice(0, 10)
            };
            
            result.innerHTML = '<div class="status info">1분 후에 할일 알람이 울립니다...</div>';
            console.log('할일 알람 시뮬레이션 시작:', testTodo);
            
            setTimeout(() => {
                try {
                    const notification = new Notification('⏰ 할일 알림', {
                        body: `${testTodo.text}\n시간: ${testTodo.time}\n우선순위: ${testTodo.priority}`,
                        tag: `todo-${testTodo.id}`,
                        requireInteraction: true
                    });
                    
                    notification.onclick = function() {
                        console.log('할일 알람 클릭됨');
                        notification.close();
                    };
                    
                    setTimeout(() => {
                        notification.close();
                    }, 10000);
                    
                    result.innerHTML = '<div class="status success">할일 알람이 성공적으로 표시되었습니다!</div>';
                    console.log('할일 알람 시뮬레이션 성공');
                    
                } catch (error) {
                    result.innerHTML = '<div class="status error">할일 알람 생성 실패: ' + error.message + '</div>';
                    console.error('할일 알람 시뮬레이션 실패:', error);
                }
            }, 60000);
        }
        
        // 페이지 로드 시 초기화
        window.addEventListener('load', function() {
            console.log('알람 진단 도구 로드됨');
            checkBrowserSupport();
            checkPermissionStatus();
        });
    </script>
</body>
</html>
